version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "Installing SAM CLI..."
        - pip3 install aws-sam-cli
        - sam --version
        - echo "Validating SAM template..."
        - cd backend && sam validate --template template.yaml
    build:
      commands:
        - echo "Building SAM application..."
        - cd backend && sam build --template template.yaml
    postBuild:
      commands:
        - echo "Deploying SAM application..."
        - cd backend && sam deploy --template template.yaml --stack-name agendafacil-$AWS_BRANCH --capabilities CAPABILITY_IAM --parameter-overrides Environment=$AWS_BRANCH CognitoDomainPrefix=agenda-facil-$AWS_BRANCH --region us-east-1 --no-confirm-changeset --no-fail-on-empty-changeset
        - echo "SAM deployment completed successfully"
frontend:
  phases:
    build:
      commands:
        - echo "Building frontend..."
        - mkdir -p build/web
        - echo '<!DOCTYPE html><html><head><title>AgendaFacil SaaS</title></head><body><h1>ðŸš€ AgendaFacil SaaS - Sistema PIX Ativo!</h1><p>Backend API com PIX funcionando</p></body></html>' > build/web/index.html
  artifacts:
    baseDirectory: build/web
    files:
      - '**/*'