version: 1
backend:
  phases:
    preBuild:
      commands:
        - echo "Installing SAM CLI..."
        - pip install aws-sam-cli
        - cd backend
    build:
      commands:
        - echo "Building SAM application..."
        - sam build --template template-fixed-final.yaml
        - echo "Deploying SAM application..."
        - sam deploy --template template-fixed-final.yaml --stack-name agendafacil-$AWS_BRANCH --capabilities CAPABILITY_IAM --parameter-overrides Environment=$AWS_BRANCH --no-confirm-changeset
frontend:
  phases:
    preBuild:
      commands:
        - flutter pub get
    build:
      commands:
        - flutter build web --release
  artifacts:
    baseDirectory: build/web
    files:
      - '**/*'
  cache:
    paths:
      - ~/.pub-cache/**/*