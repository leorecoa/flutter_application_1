{
  "widgets": [
    {
      "type": "metric",
      "x": 0,
      "y": 0,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Invocations", "FunctionName", "agenda-facil-${env}-AuthFunction", { "stat": "Sum", "period": 300 } ],
          [ ".", ".", ".", "agenda-facil-${env}-AppointmentsFunction", { "stat": "Sum", "period": 300 } ],
          [ ".", ".", ".", "agenda-facil-${env}-ServicesFunction", { "stat": "Sum", "period": 300 } ],
          [ ".", ".", ".", "agenda-facil-${env}-TenantFunction", { "stat": "Sum", "period": 300 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Lambda Invocations",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 0,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Errors", "FunctionName", "agenda-facil-${env}-AuthFunction", { "stat": "Sum", "period": 300 } ],
          [ ".", ".", ".", "agenda-facil-${env}-AppointmentsFunction", { "stat": "Sum", "period": 300 } ],
          [ ".", ".", ".", "agenda-facil-${env}-ServicesFunction", { "stat": "Sum", "period": 300 } ],
          [ ".", ".", ".", "agenda-facil-${env}-TenantFunction", { "stat": "Sum", "period": 300 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Lambda Errors",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 6,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/Lambda", "Duration", "FunctionName", "agenda-facil-${env}-AuthFunction", { "stat": "Average", "period": 300 } ],
          [ ".", ".", ".", "agenda-facil-${env}-AppointmentsFunction", { "stat": "Average", "period": 300 } ],
          [ ".", ".", ".", "agenda-facil-${env}-ServicesFunction", { "stat": "Average", "period": 300 } ],
          [ ".", ".", ".", "agenda-facil-${env}-TenantFunction", { "stat": "Average", "period": 300 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Lambda Duration",
        "period": 300,
        "annotations": {
          "horizontal": [
            {
              "label": "Warning",
              "value": 3000
            },
            {
              "label": "Critical",
              "value": 5000
            }
          ]
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 6,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "Count", "ApiName", "agenda-facil-api", { "stat": "SampleCount", "period": 300 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "API Gateway Request Count",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 12,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "4XXError", "ApiName", "agenda-facil-api", { "stat": "Sum", "period": 300 } ],
          [ ".", "5XXError", ".", ".", { "stat": "Sum", "period": 300 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "API Gateway Errors",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 12,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/ApiGateway", "Latency", "ApiName", "agenda-facil-api", { "stat": "p50", "period": 300, "label": "p50" } ],
          [ "...", { "stat": "p90", "period": 300, "label": "p90" } ],
          [ "...", { "stat": "p99", "period": 300, "label": "p99" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "API Gateway Latency",
        "period": 300,
        "annotations": {
          "horizontal": [
            {
              "label": "Warning",
              "value": 1000
            },
            {
              "label": "Critical",
              "value": 3000
            }
          ]
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 18,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/DynamoDB", "ConsumedReadCapacityUnits", "TableName", "AgendaFacilTable", { "stat": "Sum", "period": 300 } ],
          [ ".", "ConsumedWriteCapacityUnits", ".", ".", { "stat": "Sum", "period": 300 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "DynamoDB Consumed Capacity",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 18,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AWS/DynamoDB", "ThrottledRequests", "TableName", "AgendaFacilTable", { "stat": "Sum", "period": 300 } ],
          [ ".", "SuccessfulRequestLatency", ".", ".", { "stat": "Average", "period": 300, "yAxis": "right" } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "DynamoDB Throttles and Latency",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 24,
      "width": 24,
      "height": 6,
      "properties": {
        "metrics": [
          [ "AgendaFacil", "TenantCount", "Environment", "${env}", { "stat": "Maximum", "period": 3600 } ],
          [ ".", "ActiveUsers", ".", ".", { "stat": "Maximum", "period": 3600 } ],
          [ ".", "AppointmentsCreated", ".", ".", { "stat": "Sum", "period": 3600 } ]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${region}",
        "title": "Business Metrics",
        "period": 3600
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 30,
      "width": 24,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/lambda/agenda-facil-${env}-AuthFunction' | SOURCE '/aws/lambda/agenda-facil-${env}-AppointmentsFunction' | SOURCE '/aws/lambda/agenda-facil-${env}-ServicesFunction' | SOURCE '/aws/lambda/agenda-facil-${env}-TenantFunction' | filter level = 'ERROR' | stats count(*) as errorCount by bin(30s)",
        "region": "${region}",
        "stacked": false,
        "title": "Lambda Error Logs",
        "view": "timeSeries"
      }
    }
  ]
}